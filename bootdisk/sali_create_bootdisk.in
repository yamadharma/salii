#!/bin/sh
#
# A wrapper scrip which uses ISOLINUX to
# create a bootable SALI cd/usb
#

SALI_VERSION="@SALI_VERSION@"
ARCH="@ARCH@"
CDROOT=$(dirname $(readlink -f $0))
SALIROOT=$(readlink -e "${CDROOT}/..")
SALIISO="${SALIROOT}/sali-${ARCH}-${VERSION}-hybrid.iso"
GENISOIMAGE=$(which genisoimage)
ISOHYBRID=$(which isohybrid)

if [ -z "${GENISOIMAGE}" ]; then echo "Could not locate command genisoimage"; exit 1; fi
if [ -z "${ISOHYBRID}" ]; then echo "Could not locate command isohybrid (part of syslinux)"; exit 1; fi


## Step 1: Copy kernel and initrd
cp "${SALIROOT}/${ARCH}/kernel" "${CDROOT}/kernel"
cp "${SALIROOT}/${ARCH}/initrd.img" "${CDROOT}/images"

## Step 2: Generate iso
printf "CREATING A SALI ISO IMAGE\n\n"
$GENISOIMAGE -o "${SALIISO}" -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table $CDROOT

## Step 3: Make hybrid iso
printf "\n\nCONVERTING IMAGE TO HYBRID IMAGE"
$ISOHYBRID "${SALIISO}"
printf " done\n"

printf "\nISO IMAGE HAS BEEN STORED TO\n\t${SALIISO}\n"
