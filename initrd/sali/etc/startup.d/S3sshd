start_sshd(){
    p_stage "Starting ssh server"

    case "${SSHD_GENKEYS}" in
        y|Y|yes|Yes|YES)
            p_service "removing SALI default rsa/dsa/ecdsa keys"
            rm -rf /etc/ssh/ssh_host_* 2&>1 > /dev/null
        ;;
    esac


    if [ ! -f "/etc/ssh/ssh_host_dsa_key" ]
    then
        p_service "creating a new dsa key"
        ssh-keygen -t dsa -N "" -f /etc/ssh/ssh_host_dsa_key -q
    fi
    chmod 600 /etc/ssh/ssh_host_dsa_key

    if [ ! -f "/etc/ssh/ssh_host_rsa_key" ]
    then
        p_service "creating a new rsa key"
        ssh-keygen -t rsa -N "" -f /etc/ssh/ssh_host_rsa_key -q
    fi
    chmod 600 /etc/ssh/ssh_host_rsa_key

    if [ ! -f "/etc/ssh/ssh_host_ecdsa_key" ]
    then
        p_service "creating a new ecdsa key"
        ssh-keygen -t rsa -N "" -f /etc/ssh/ssh_host_ecdsa_key -q
    fi
    chmod 600 /etc/ssh/ssh_host_ecdsa_key

    mkdir -p /var/run/sshd
    chmod 0755 /var/run/sshd
    /usr/sbin/sshd

    if [ "$?" != 0 ]
    then
        p_service "failed to start sshd"
        return 1
    fi
}

case "${SSHD}" in

    y|Y|yes|Yes|YES)
        start_sshd
    ;;

esac

return 0
